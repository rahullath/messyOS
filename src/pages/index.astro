---
// src/pages/index.astro
import DashboardLayout from '../layouts/DashboardLayout.astro';
import { getDashboardData } from '../lib/data/dashboard';

const session = Astro.locals.session;
const dashboardData = await getDashboardData(Astro.cookies, session);
---

<DashboardLayout title="MeshOS - Dashboard">
  <div class="dashboard-content">
    {dashboardData.error ? (
      <div class="error-container">
        <h2 class="text-2xl text-accent-error">Dashboard Loading Error</h2>
        <p class="text-text-muted">{dashboardData.error}</p>
        <a href="/login" class="btn btn-primary mt-4">Return to Login</a>
      </div>
    ) : (
      <div>
        <h1 class="text-3xl font-semibold mb-4">
          Welcome, {dashboardData.user?.email?.split('@')[0] || 'User'}
        </h1>

        <div class="stats-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
          <div class="card">
            <h3>Habits</h3>
            <p>{dashboardData.habits?.length || 0} Active Habits</p>
          </div>
          
          <div class="card">
            <h3>Tasks</h3>
            <p>
              {dashboardData.taskStats.total} Total 
              ({dashboardData.taskStats.completed} Completed)
            </p>
          </div>
        </div>
      </div>
    )}
  </div>

  <script>
    // Client-side enhancement script
    document.addEventListener('DOMContentLoaded', () => {
      // Add any client-side interactivity here
    });
  </script>
</DashboardLayout>

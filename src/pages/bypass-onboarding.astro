---
// Create default preferences to bypass onboarding completely
import { createServerAuth } from '../lib/auth/simple-multi-user';

const serverAuth = createServerAuth(Astro.cookies);
const user = await serverAuth.getUser();

if (!user) {
  return Astro.redirect('/login');
}

// Check if user already has preferences
const existingPrefs = await serverAuth.getUserPreferences(user.id);

if (!existingPrefs) {
  const created = await serverAuth.createDefaultPreferences(user.id, user.email);

  if (!created) {
    console.error('Error creating default preferences for onboarding bypass');
  } else {
    console.log('Onboarding bypassed successfully');
  }
}

// Always redirect to dashboard
return Astro.redirect('/dashboard');
---

---
// src/pages/import.astro
import DashboardLayout from '../layouts/DashboardLayout.astro';
import EnhancedLoopHabitsImport from '../components/import/EnhancedLoopHabitsImport.tsx';
import FinanceDataImport from '../components/import/FinanceDataImport.tsx';
import ContentDataImport from '../components/import/ContentDataImport.tsx';
---

<DashboardLayout title="Import Data - MeshOS">
  <div class="app-content-wrap space-y-6 sm:space-y-8">
    <div>
      <h1 class="text-2xl sm:text-3xl font-semibold text-text-primary mb-2">Import Data</h1>
      <p class="text-sm sm:text-base text-text-secondary">
        Bring your existing data into MeshOS. Start with one module at a time.
      </p>
    </div>

    <div class="grid grid-cols-2 sm:grid-cols-4 gap-2" id="import-module-tabs">
      <button type="button" data-module="habits" class="import-tab-btn rounded-lg border border-border px-3 py-2 text-sm font-medium bg-accent-primary/15 text-accent-primary">Habits</button>
      <button type="button" data-module="finance" class="import-tab-btn rounded-lg border border-border px-3 py-2 text-sm font-medium text-text-secondary hover:text-text-primary hover:bg-surface-hover">Finance</button>
      <button type="button" data-module="content" class="import-tab-btn rounded-lg border border-border px-3 py-2 text-sm font-medium text-text-secondary hover:text-text-primary hover:bg-surface-hover">Content</button>
      <button type="button" data-module="health" class="import-tab-btn rounded-lg border border-border px-3 py-2 text-sm font-medium text-text-secondary hover:text-text-primary hover:bg-surface-hover">Health</button>
    </div>

    <section data-module-panel="habits" class="import-module-panel space-y-4">
      <div class="card">
        <h2 class="text-lg font-semibold text-text-primary">Habits Import</h2>
        <p class="text-sm text-text-secondary mt-1">Import from Loop Habits exports.</p>
      </div>
      <EnhancedLoopHabitsImport client:load />
    </section>

    <section data-module-panel="finance" class="import-module-panel hidden space-y-4">
      <div class="card">
        <h2 class="text-lg font-semibold text-text-primary">Finance Import</h2>
        <p class="text-sm text-text-secondary mt-1">Import statements and portfolio data.</p>
      </div>
      <FinanceDataImport client:load />
    </section>

    <section data-module-panel="content" class="import-module-panel hidden space-y-4">
      <div class="card">
        <h2 class="text-lg font-semibold text-text-primary">Content Import</h2>
        <p class="text-sm text-text-secondary mt-1">Import movies, TV and reading logs.</p>
      </div>
      <ContentDataImport client:load />
    </section>

    <section data-module-panel="health" class="import-module-panel hidden space-y-4">
      <div class="card">
        <h2 class="text-lg font-semibold text-text-primary">Health Import</h2>
        <p class="text-sm text-text-secondary mt-2">Health import is available as a manual path for now.</p>
        <a href="/settings" class="inline-flex mt-4 px-4 py-2 rounded-lg border border-border text-sm text-text-secondary hover:text-text-primary hover:bg-surface-hover transition-colors">
          Configure Health Preferences
        </a>
      </div>
    </section>
  </div>
</DashboardLayout>

<script>
  const tabButtons = Array.from(document.querySelectorAll('.import-tab-btn'));
  const panels = Array.from(document.querySelectorAll('.import-module-panel'));

  function setActiveModule(moduleName) {
    for (const panel of panels) {
      panel.classList.toggle('hidden', panel.dataset.modulePanel !== moduleName);
    }

    for (const button of tabButtons) {
      const active = button.dataset.module === moduleName;
      button.classList.toggle('bg-accent-primary/15', active);
      button.classList.toggle('text-accent-primary', active);
      button.classList.toggle('text-text-secondary', !active);
      button.classList.toggle('hover:bg-surface-hover', !active);
      button.classList.toggle('hover:text-text-primary', !active);
    }
  }

  for (const button of tabButtons) {
    button.addEventListener('click', () => {
      const moduleName = button.dataset.module;
      if (moduleName) {
        setActiveModule(moduleName);
      }
    });
  }

  // On larger screens keep all modules visible for faster multi-import workflows.
  function updateLayoutForViewport() {
    if (window.innerWidth >= 1024) {
      for (const panel of panels) {
        panel.classList.remove('hidden');
      }
    } else {
      const activeBtn = tabButtons.find((button) => button.classList.contains('bg-accent-primary/15'));
      setActiveModule(activeBtn?.dataset.module || 'habits');
    }
  }

  updateLayoutForViewport();
  window.addEventListener('resize', updateLayoutForViewport);
</script>

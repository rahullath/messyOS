---
// src/pages/import.astro - Enhanced with Finance Import
import DashboardLayout from '../layouts/DashboardLayout.astro';
import LoopHabitsImport from '../components/import/LoopHabitsImport.tsx';
import FinanceDataImport from '../components/import/FinanceDataImport.tsx';
---

<DashboardLayout title="Import Data - MeshOS">
  <div class="space-y-8">
    <!-- Header -->
    <div>
      <h1 class="text-3xl font-semibold text-text-primary mb-4">Import Data</h1>
      <p class="text-text-secondary mb-8">
        Import your historical data from various apps and services to get a complete picture of your life.
      </p>
    </div>

    <!-- Import Cards Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- Loop Habits Import -->
      <div class="space-y-6">
        <div class="flex items-center space-x-3 mb-4">
          <div class="w-8 h-8 bg-accent-success/20 rounded-lg flex items-center justify-center">
            <svg class="w-5 h-5 text-accent-success" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </div>
          <div>
            <h2 class="text-xl font-semibold text-text-primary">Habits Data</h2>
            <p class="text-sm text-text-muted">From Loop Habits app</p>
          </div>
        </div>
        
        <LoopHabitsImport client:load />
        
        <!-- Import Instructions -->
        <div class="card p-4 bg-accent-success/5 border border-accent-success/20">
          <h4 class="font-medium text-accent-success mb-2">üì± How to Export from Loop Habits</h4>
          <ol class="text-sm text-text-secondary space-y-1 list-decimal list-inside">
            <li>Open Loop Habits app</li>
            <li>Go to Settings ‚Üí Export</li>
            <li>Select "Export as CSV"</li>
            <li>Choose all three files: Habits.csv, Checkmarks.csv, Scores.csv</li>
            <li>Upload them above</li>
          </ol>
        </div>
      </div>

      <!-- Finance Import -->
      <div class="space-y-6">
        <div class="flex items-center space-x-3 mb-4">
          <div class="w-8 h-8 bg-accent-warning/20 rounded-lg flex items-center justify-center">
            <svg class="w-5 h-5 text-accent-warning" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
            </svg>
          </div>
          <div>
            <h2 class="text-xl font-semibold text-text-primary">Finance Data</h2>
            <p class="text-sm text-text-muted">Bank statements & crypto portfolio</p>
          </div>
        </div>
        
        <FinanceDataImport client:load />
        
        <!-- Finance Import Instructions -->
        <div class="card p-4 bg-accent-warning/5 border border-accent-warning/20">
          <h4 class="font-medium text-accent-warning mb-2">üí∞ Supported Finance Data</h4>
          <ul class="text-sm text-text-secondary space-y-1 list-disc list-inside">
            <li><strong>Bank Statements:</strong> CSV format from Jupiter Bank</li>
            <li><strong>Crypto Portfolio:</strong> Text format with holdings</li>
            <li><strong>Subscription List:</strong> Manual text input</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Health Data Import -->
    <div class="space-y-6">
      <div class="flex items-center space-x-3 mb-4">
        <div class="w-8 h-8 bg-accent-error/20 rounded-lg flex items-center justify-center">
          <svg class="w-5 h-5 text-accent-error" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
          </svg>
        </div>
        <div>
          <h2 class="text-xl font-semibold text-text-primary">Health Data</h2>
          <p class="text-sm text-text-muted">From Huawei Band 9</p>
        </div>
      </div>
      
      <!-- Health Import Component (you'll need to create this) -->
      <div class="card p-6">
        <h3 class="text-lg font-semibold text-text-primary mb-4">Import Health Metrics</h3>
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-text-secondary mb-2">Sleep Data (sleep.txt)</label>
            <input type="file" accept=".txt" class="w-full px-3 py-2 bg-surface border border-border rounded-lg text-text-primary" />
          </div>
          <div>
            <label class="block text-sm font-medium text-text-secondary mb-2">Heart Rate Data (heartrate.txt)</label>
            <input type="file" accept=".txt" class="w-full px-3 py-2 bg-surface border border-border rounded-lg text-text-primary" />
          </div>
          <div>
            <label class="block text-sm font-medium text-text-secondary mb-2">Stress Data (stress.txt)</label>
            <input type="file" accept=".txt" class="w-full px-3 py-2 bg-surface border border-border rounded-lg text-text-primary" />
          </div>
          <button class="w-full px-4 py-2 bg-accent-error text-white rounded-lg hover:bg-accent-error/90 transition-colors">
            Import Health Data
          </button>
        </div>
      </div>
      
      <!-- Health Import Instructions -->
      <div class="card p-4 bg-accent-error/5 border border-accent-error/20">
        <h4 class="font-medium text-accent-error mb-2">‚ù§Ô∏è How to Export from Huawei Health</h4>
        <ol class="text-sm text-text-secondary space-y-1 list-decimal list-inside">
          <li>Open Huawei Health app</li>
          <li>Go to Me ‚Üí Settings ‚Üí Data Management</li>
          <li>Export data as TXT format</li>
          <li>Upload Sleep, Heart Rate, and Stress files above</li>
        </ol>
      </div>
    </div>

    <!-- Import Status & Tips -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Import Status -->
      <div class="card p-6">
        <h3 class="text-lg font-semibold text-text-primary mb-4">Import Status</h3>
        <div class="space-y-3">
          <div class="flex items-center justify-between">
            <div class="flex items-center space-x-2">
              <div class="w-2 h-2 bg-accent-success rounded-full"></div>
              <span class="text-sm text-text-secondary">Habits Data</span>
            </div>
            <span class="text-sm text-accent-success">‚úÖ 10 habits, 896 entries</span>
          </div>
          
          <div class="flex items-center justify-between">
            <div class="flex items-center space-x-2">
              <div class="w-2 h-2 bg-accent-warning rounded-full"></div>
              <span class="text-sm text-text-secondary">Finance Data</span>
            </div>
            <span class="text-sm text-text-muted">Ready for import</span>
          </div>
          
          <div class="flex items-center justify-between">
            <div class="flex items-center space-x-2">
              <div class="w-2 h-2 bg-accent-error rounded-full"></div>
              <span class="text-sm text-text-secondary">Health Data</span>
            </div>
            <span class="text-sm text-accent-success">‚úÖ Sleep, HR, Stress imported</span>
          </div>
        </div>
      </div>

      <!-- Import Tips -->
      <div class="card p-6">
        <h3 class="text-lg font-semibold text-text-primary mb-4">Import Tips</h3>
        <div class="space-y-3 text-sm text-text-secondary">
          <div class="flex items-start space-x-2">
            <span class="text-accent-success mt-0.5">üí°</span>
            <span>Import habits data first to establish your baseline patterns</span>
          </div>
          <div class="flex items-start space-x-2">
            <span class="text-accent-warning mt-0.5">‚ö†Ô∏è</span>
            <span>Large files may take a few minutes to process</span>
          </div>
          <div class="flex items-start space-x-2">
            <span class="text-accent-primary mt-0.5">üîÑ</span>
            <span>You can re-import data to update with new entries</span>
          </div>
          <div class="flex items-start space-x-2">
            <span class="text-accent-purple mt-0.5">üöÄ</span>
            <span>More import sources coming based on your usage patterns</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Data Preview -->
    <div class="card p-6">
      <h3 class="text-lg font-semibold text-text-primary mb-4">Your Current Data Overview</h3>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="text-center">
          <div class="text-2xl font-bold text-accent-success">10</div>
          <div class="text-sm text-text-muted">Active Habits</div>
        </div>
        <div class="text-center">
          <div class="text-2xl font-bold text-accent-primary">896</div>
          <div class="text-sm text-text-muted">Habit Entries</div>
        </div>
        <div class="text-center">
          <div class="text-2xl font-bold text-accent-warning">$130.72</div>
          <div class="text-sm text-text-muted">Crypto Portfolio</div>
        </div>
        <div class="text-center">
          <div class="text-2xl font-bold text-accent-purple">117</div>
          <div class="text-sm text-text-muted">Best Streak (days)</div>
        </div>
      </div>
    </div>

    <!-- Developer Debug Section (Optional) -->
    <details class="card p-6">
      <summary class="cursor-pointer text-text-primary font-medium">üîß Developer Info</summary>
      <div class="mt-4 text-sm text-text-muted space-y-2">
        <p><strong>User ID:</strong> 368deac7-8526-45eb-927a-6a373c95d8c6</p>
        <p><strong>Database:</strong> Supabase (mdhtpjpwwbuepsytgrva)</p>
        <p><strong>Import Endpoints:</strong></p>
        <ul class="list-disc list-inside ml-4 space-y-1">
          <li><code>/api/import/loop-habits</code> - Habits CSV import</li>
          <li><code>/api/import/finance</code> - Finance data import</li>
          <li><code>/api/import/health</code> - Health data (coming soon)</li>
        </ul>
      </div>
    </details>
  </div>
</DashboardLayout>

<style>
  /* Custom styles for import page */
  .card {
    @apply bg-surface border border-border rounded-lg;
  }
  
  details summary {
    @apply hover:text-accent-primary transition-colors;
  }
  
  code {
    @apply bg-surface-hover px-2 py-1 rounded text-accent-primary text-xs;
  }
</style>
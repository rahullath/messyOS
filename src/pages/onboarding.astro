---
// src/pages/onboarding.astro - User Onboarding Flow
import Layout from '../layouts/Layout.astro';
import { createServerAuth } from '../lib/auth/simple-multi-user';
import OnboardingFlow from '../components/onboarding/OnboardingFlow.tsx';

// Require authentication
const serverAuth = createServerAuth(Astro.cookies);
const user = await serverAuth.getUser();

if (!user) {
  return Astro.redirect('/login');
}

// Note: Middleware will handle redirecting users who have already completed onboarding
---

<Layout title="Welcome to messyOS - Setup">
  <div class="container mx-auto max-w-2xl py-12">
    <h1 class="text-3xl font-bold mb-4 text-center">Welcome to messyOS</h1>
    <p class="text-center mb-8">Let's get your workspace set up.</p>
    <OnboardingFlow client:load />
  </div>
</Layout>

<script>
  // Listen for onboarding completion and redirect
  window.addEventListener('onboardingComplete', () => {
    console.log('üéâ Onboarding completed, redirecting to dashboard...');
    window.location.href = '/';
  });
  
  // Add debugging for page load
  console.log('üìÑ Onboarding page loaded');
  
  // Check if user is authenticated
  document.addEventListener('DOMContentLoaded', () => {
    console.log('üîç Checking authentication status...');
  });
</script>

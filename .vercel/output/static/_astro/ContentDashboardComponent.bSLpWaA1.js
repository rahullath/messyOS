import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as o}from"./index.Bd8wGOW-.js";import"./_commonjsHelpers.D6-XlEtG.js";import"./index.c0qeY2gs.js";const D=({tmdbId:m,title:u,type:n,rating:h,vote_average:j,watch_date:b})=>{const[d,y]=o.useState(null),[p,N]=o.useState(!1),[a,x]=o.useState(!1);o.useEffect(()=>{m&&!p&&!d&&!a&&(N(!0),fetch(`/api/content/poster/${m}`).then(c=>c.json()).then(c=>{c.success&&c.posterUrl?y(c.posterUrl):x(!0)}).catch(c=>{console.log("Failed to fetch poster for",u,":",c),x(!0)}).finally(()=>N(!1)))},[m,u]);const _=n==="movie"?"from-blue-600 to-purple-700":n==="tv_show"?"from-purple-600 to-pink-700":"from-green-600 to-teal-700";return e.jsxs("div",{className:`aspect-[2/3] rounded-t-lg flex flex-col items-center justify-center text-white relative overflow-hidden bg-gradient-to-br ${_}`,children:[d?e.jsx("img",{src:d,alt:u,className:"w-full h-full object-cover",onError:()=>{y(null),x(!0)}}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute inset-0 opacity-10",children:e.jsx("div",{className:"absolute inset-0 bg-gradient-radial from-white/20 to-transparent"})}),e.jsx("div",{className:`text-4xl mb-2 relative z-10 ${p?"animate-pulse":""}`,children:p?"ðŸ”„":n==="movie"?"ðŸŽ¬":n==="tv_show"?"ðŸ“º":"ðŸ“š"})]}),h&&e.jsxs("div",{className:"absolute top-2 right-2 bg-black/70 text-yellow-400 px-2 py-1 rounded text-xs font-medium flex items-center z-10",children:[e.jsx("span",{className:"mr-1",children:"â­"}),h.toFixed(1)]}),j&&(!h||Math.abs(j-h)>.5)&&e.jsxs("div",{className:"absolute top-2 left-2 bg-blue-600/80 text-white px-2 py-1 rounded text-xs font-medium z-10",children:["TMDB ",j.toFixed(1)]}),b&&e.jsx("div",{className:"absolute bottom-2 left-2 bg-black/70 text-gray-300 px-2 py-1 rounded text-xs z-10",children:new Date(b).getFullYear()})]})};function B(){const[m,u]=o.useState([]),[n,h]=o.useState(null),[j,b]=o.useState(!0),[d,y]=o.useState("all"),[p,N]=o.useState("date"),[a,x]=o.useState(null);o.useEffect(()=>{_()},[]);const _=async()=>{try{const i=await(await fetch("/api/content")).json();if(i.success){const v=i.content.map(w=>{const r=w.metadata||{};let f=null;return r.rating&&(typeof r.rating=="string"&&r.rating.includes("/")?f=parseInt(r.rating.split("/")[0])/20:typeof r.rating=="number"&&(f=r.rating)),{id:w.id,title:r.tmdb_title||r.title||"Unknown",type:r.content_type||"movie",rating:f,genres:Array.isArray(r.genres)?r.genres:typeof r.genres=="string"?r.genres.split(", ").filter(g=>g.trim()):[],overview:r.overview,poster_url:void 0,tmdb_id:r.tmdb_id,season_episode:r.season_episode,watch_date:r.watched_date||r.completed_at,cast:r.cast,networks:r.networks,status:r.status,vote_average:r.vote_average,imdb_id:r.imdb_id,keywords:typeof r.keywords=="string"?r.keywords.split(", ").filter(g=>g.trim()):r.keywords||[]}});u(v),h(c(v))}}catch(t){console.error("Failed to fetch content:",t)}finally{b(!1)}},c=t=>{const i=t.filter(s=>s.type==="movie"),v=t.filter(s=>s.type==="tv_show"),w=t.filter(s=>s.type==="book"),r=t.filter(s=>s.rating&&s.rating>0),f=r.length>0?r.reduce((s,l)=>s+(l.rating||0),0)/r.length:0,g=new Map;t.forEach(s=>{s.genres&&Array.isArray(s.genres)&&s.genres.forEach(l=>{g.set(l,(g.get(l)||0)+1)})});const E=Array.from(g.entries()).map(([s,l])=>({genre:s,count:l})).sort((s,l)=>l.count-s.count).slice(0,5),k=[];for(let s=11;s>=0;s--){const l=new Date;l.setMonth(l.getMonth()-s);const F=l.toISOString().slice(0,7),A=t.filter(S=>S.watch_date&&S.watch_date.startsWith(F)).length;k.push({month:l.toLocaleDateString("en-US",{month:"short"}),count:A})}const M=v.filter(s=>s.status==="Returning Series").slice(0,5).map(s=>({title:s.title,season_episode:"Next Episode",air_date:"TBA",network:s.networks||"Unknown",poster_url:s.poster_url}));return{total:t.length,movies:i.length,tv_shows:v.length,books:w.length,avgRating:Math.round(f*10)/10,topGenres:E,recentlyWatched:t.filter(s=>s.watch_date).sort((s,l)=>new Date(l.watch_date).getTime()-new Date(s.watch_date).getTime()).slice(0,10),monthlyProgress:k,upcomingEpisodes:M}},C=[...m.filter(t=>d==="all"?!0:t.type===d)].sort((t,i)=>{switch(p){case"rating":return(i.rating||0)-(t.rating||0);case"title":return t.title.localeCompare(i.title);case"date":default:return new Date(i.watch_date||0).getTime()-new Date(t.watch_date||0).getTime()}});return j?e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-500"}),e.jsx("span",{className:"ml-3 text-gray-300",children:"Loading content..."})]}):!n||m.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 bg-purple-500/10 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-purple-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M7 4V2a1 1 0 011-1h8a1 1 0 011 1v2h4a1 1 0 011 1v1a1 1 0 01-1 1h-1v12a2 2 0 01-2 2H6a2 2 0 01-2-2V7H3a1 1 0 01-1-1V5a1 1 0 011-1h4z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-200 mb-2",children:"No content data yet"}),e.jsx("p",{className:"text-gray-400 mb-4",children:"Import your enriched Serializd data to start tracking"}),e.jsx("button",{onClick:()=>window.location.href="/import",className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:"Import Content Data"})]}):e.jsxs("div",{className:"space-y-6",children:[n.upcomingEpisodes.length>0&&e.jsxs("div",{className:"bg-gradient-to-r from-blue-900/20 to-purple-900/20 border border-blue-500/20 rounded-lg p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-blue-300 mb-4 flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"Upcoming Episodes"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-4",children:n.upcomingEpisodes.map((t,i)=>e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-3 border border-gray-700/50",children:[e.jsx("div",{className:"text-sm font-medium text-gray-200 truncate",children:t.title}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:t.network}),e.jsx("div",{className:"text-xs text-blue-400 mt-1",children:t.air_date})]},i))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-gray-800/50 rounded-lg p-4 border border-gray-700/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Total Entries"}),e.jsx("p",{className:"text-2xl font-bold text-gray-200",children:n.total})]}),e.jsx("div",{className:"text-2xl",children:"ðŸ“Š"})]})}),e.jsx("div",{className:"bg-gray-800/50 rounded-lg p-4 border border-gray-700/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Movies"}),e.jsx("p",{className:"text-2xl font-bold text-blue-400",children:n.movies})]}),e.jsx("div",{className:"text-2xl",children:"ðŸŽ¬"})]})}),e.jsx("div",{className:"bg-gray-800/50 rounded-lg p-4 border border-gray-700/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"TV Shows"}),e.jsx("p",{className:"text-2xl font-bold text-purple-400",children:n.tv_shows})]}),e.jsx("div",{className:"text-2xl",children:"ðŸ“º"})]})}),e.jsx("div",{className:"bg-gray-800/50 rounded-lg p-4 border border-gray-700/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Avg Rating"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-400",children:n.avgRating})]}),e.jsx("div",{className:"text-2xl",children:"â­"})]})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsx("div",{className:"flex gap-2",children:["all","movie","tv_show","book"].map(t=>e.jsx("button",{onClick:()=>y(t),className:`px-3 py-1 rounded-lg text-sm transition-colors ${d===t?"bg-purple-600 text-white":"bg-gray-700/50 text-gray-300 hover:bg-gray-700"}`,children:t==="all"?"All":t==="tv_show"?"TV Shows":t.charAt(0).toUpperCase()+t.slice(1)},t))}),e.jsx("div",{className:"flex gap-2",children:e.jsxs("select",{value:p,onChange:t=>N(t.target.value),className:"bg-gray-700 text-gray-200 px-3 py-1 rounded-lg text-sm border border-gray-600",children:[e.jsx("option",{value:"date",children:"Sort by Date"}),e.jsx("option",{value:"rating",children:"Sort by Rating"}),e.jsx("option",{value:"title",children:"Sort by Title"})]})})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4",children:C.map(t=>e.jsxs("div",{onClick:()=>x(t),className:"bg-gray-800/50 rounded-lg overflow-hidden cursor-pointer hover:bg-gray-700/50 transition-all border border-gray-700/50 hover:border-purple-500/50",children:[e.jsx(D,{tmdbId:t.tmdb_id,title:t.title,type:t.type,rating:t.rating,vote_average:t.vote_average,watch_date:t.watch_date}),e.jsxs("div",{className:"p-3",children:[e.jsx("h3",{className:"font-medium text-sm text-gray-200 truncate mb-1",children:t.title}),t.season_episode&&e.jsx("p",{className:"text-xs text-gray-400 truncate mb-1",children:t.season_episode}),t.rating&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-yellow-400 text-xs",children:"â­"}),e.jsx("span",{className:"text-xs text-gray-300",children:t.rating.toFixed(1)})]}),t.watch_date&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(t.watch_date).toLocaleDateString()})]})]},t.id))}),a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",onClick:()=>x(null),children:e.jsx("div",{className:"bg-gray-800 rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",onClick:t=>t.stopPropagation(),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-200",children:a.title}),e.jsx("button",{onClick:()=>x(null),className:"text-gray-400 hover:text-gray-200",children:"âœ•"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[a.overview&&e.jsx("p",{className:"text-gray-300 mb-4",children:a.overview}),e.jsxs("div",{className:"space-y-2 text-sm",children:[a.genres.length>0&&e.jsxs("p",{children:[e.jsx("strong",{className:"text-gray-400",children:"Genres:"})," ",e.jsx("span",{className:"text-gray-300",children:a.genres.join(", ")})]}),a.cast&&e.jsxs("p",{children:[e.jsx("strong",{className:"text-gray-400",children:"Cast:"})," ",e.jsx("span",{className:"text-gray-300",children:a.cast})]}),a.networks&&e.jsxs("p",{children:[e.jsx("strong",{className:"text-gray-400",children:"Network:"})," ",e.jsx("span",{className:"text-gray-300",children:a.networks})]}),a.rating&&e.jsxs("p",{children:[e.jsx("strong",{className:"text-gray-400",children:"Your Rating:"})," ",e.jsxs("span",{className:"text-yellow-400",children:["â­ ",a.rating.toFixed(1),"/10"]})]}),a.vote_average&&e.jsxs("p",{children:[e.jsx("strong",{className:"text-gray-400",children:"TMDB Rating:"})," ",e.jsxs("span",{className:"text-blue-400",children:[a.vote_average.toFixed(1),"/10"]})]})]})]}),e.jsx("div",{className:"text-center",children:a.poster_url&&e.jsx("img",{src:a.poster_url,alt:a.title,className:"w-full max-w-48 mx-auto rounded-lg"})})]})]})})}),n.topGenres.length>0&&e.jsxs("div",{className:"bg-gray-800/50 rounded-lg p-6 border border-gray-700/50",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-200 mb-4",children:"Top Genres"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:n.topGenres.map((t,i)=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-purple-400",children:t.count}),e.jsx("div",{className:"text-sm text-gray-400",children:t.genre})]},t.genre))})]})]})}export{B as default};
